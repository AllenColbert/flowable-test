<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>任务列表</title>
    <script th:src="@{/js/jquery-3.3.1.js}"></script>
</head>
<body>
<div id="heard"  th:replace="header.html :: header"></div>

<div id="bodyBox">
    <div id="inputBox" style=" padding-left: 8% ;margin: 0 0 10px 40px">
        <label for="assignee">在这里输入Assignee：</label>
        <input type="text" id="assignee" placeholder="设置任务代办人">

        <!--表单提交的错误示范，明日去百度正确的表单提交方法-->
        <div id="node_jump_box">
            <form id="node_jump_form" onsubmit="sendData()" action="#">
                <label>
                    <input type="text" name="taskId" placeholder="任务Id">
                </label>
                <label>
                    <input type="text" name="targetNodeId" placeholder="目标节点">
                </label>
                <input type="submit">
            </form>
        </div>
    </div>

    <div id="mainBox" th:align="center">
    <table th:class="gridtable" >
        <thead>
        <th>任务Id</th>
        <th>任务名称</th>
    <!--<th>任务执行Id</th>-->
    <!--<th>流程实例Id</th>-->
    <!--<th>流程定义Id</th>-->
    <!--<th>任务定义Id</th>-->
        <th>代理人</th>
        <th>创建时间</th>
        <th>任务状态</th>
        <th>租户Id</th>
    <!--<th>表单key</th>-->
        <th>操作空间</th>
        </thead>
        <tbody>
        <tr th:each="task:${tasks}">
            <td th:text="${task.id}" ></td>
            <td th:text="${task.name}"></td>
            <!--<td th:text="${task.executionId}"></td>-->
            <!--<td th:text="${task.processInstanceId}"></td>-->
            <!--<td th:text="${task.processDefinitionId}"></td>-->
            <!--<td th:text="${task.taskDefinitionKey}"></td>-->
            <td th:text="${task.assignee}"></td>
            <td th:text="${#dates.format(task.createTime, 'yyyy-MM-dd HH:mm:ss')}" ></td>
            <td th:text="${task.suspensionState} eq 1? '运行中':'已挂起'"></td>
            <td th:text="${task.tenantId}"></td>
            <!--<td th:text="${task.formKey}"></td>-->
            <td >
                <!--<button  th:value="${task.id}"  onclick="completeTask(value)">完成任务</button>-->
                <button  th:value="${task.id}" th:class="button3" onclick="completeTaskWithAssignee(value)">完成任务</button>
                <button th:value="${task.processInstanceId}" th:class="button3" style="background-color: #1b6d85" onclick="showImage(value)">显示流程图</button>
                <button th:value="${task.processInstanceId}" th:class="button3" style="background-color: #1754c2" onclick="suspendTask(value)">挂起</button>
                <button th:value="${task.processInstanceId}" th:class="button3" style="background-color: #c28c63" onclick="activateTask(value)">激活</button>
            </td>
            </tr>
           </tbody>
      </table>
    </div>

    <div id="imgDiv" style="border-image-width: auto;text-align: center"></div>

</div>

</body>

<script>

    function showImage(processInstanceId) {
        console.log('processInstanceId:'+processInstanceId);
        $("#imgDiv").empty().append("<img src='/task/processDiagram?processInstanceId="+processInstanceId+"'>")
    }

    function completeTaskWithAssignee(taskId) {

        var assignee = $("#assignee").val();

        $.post("/task/completeTask",{"taskId":taskId,"assignee":assignee},function (result) {
            if (result.code === 200){
                reload();
            }
            if (result.code !== 200){
                showMsg(result.msg);
            }
        })
    }

    function logout() {
        $.get("/idm/logout",function () {
            window.location.href="/";
        });
    }

    function suspendTask(processInstanceId) {
        $.get("/task/suspendProcessInstanceById",{"processInstanceId":processInstanceId},function (result) {

            if (result.code === 200){
                reload();
            }
            if (result.code !== 200){
                showMsg(result.msg);
            }

        })
    }

    function activateTask(processInstanceId) {
        $.get("/task/activateProcessInstanceById",{"processInstanceId":processInstanceId},function (result) {
            if (result.code === 200){
                reload();
            }
            if (result.code !== 200){
                showMsg(result.msg);
            }
        })
    }

    function sendData(data) {
        $.post("/data",{"data":data},function (result) {
            console.log(result.data)
        });
    }
</script>
</html>
