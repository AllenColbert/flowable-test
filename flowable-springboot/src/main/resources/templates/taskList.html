<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>任务列表</title>
    <script th:src="@{/js/jquery-3.3.1.js}"></script>

    <style type="text/css">
        table {
            border: 1px solid black;
            text-align: center;
            border-collapse: collapse;
        }
        table thead th {
            border: 1px solid #7b2380;
        }
        table tbody td {
            border: 1px solid black;
        }
    </style>
</head>
<body>
<h2></h2>


<div id="heard"  th:replace="header.html :: header"></div>
<div style=" empty-cells: show;margin: auto ">
    <div id="heardBox" style=" padding-left: 5% ; margin: 14px">
        <label for="assignee">在这里输入Assignee：</label>
        <input type="text" id="assignee" placeholder="设置任务代办人">
    </div>

<div id="mainBox" style="margin: 4px">
    <table style="text-align:center; empty-cells: show;margin: auto;border: 3px" >
        <thead>
        <th>任务Id</th>
        <th>任务名称</th>
    <!--<th>任务执行Id</th>-->
        <!--<th>流程实例Id</th>-->
        <!--<th>流程定义Id</th>-->
    <!--<th>任务定义Id</th>-->
        <th>代理人</th>
        <th>创建时间</th>
        <th>任务是否挂起</th>
        <th>租户Id</th>
    <!--<th>表单key</th>-->
        <th>操作空间</th>
        </thead>
        <tbody>
        <tr th:each="task:${taskList}">
            <td th:text="${task.id}" ></td>
            <td th:text="${task.name}"></td>
            <!--<td th:text="${task.executionId}"></td>-->
            <!--<td th:text="${task.processInstanceId}"></td>-->
            <!--<td th:text="${task.processDefinitionId}"></td>-->
            <!--<td th:text="${task.taskDefinitionKey}"></td>-->
            <td th:text="${task.assignee}"></td>
            <td th:text="${task.createTime}"></td>
            <td th:text="${task.suspensionState} eq 1? '运行中':'已挂起'"></td>
            <td th:text="${task.tenantId}"></td>
            <!--<td th:text="${task.formKey}"></td>-->
            <td >
                <!--<button  th:value="${task.id}"  onclick="completeTask(value)">完成任务</button>-->
                <button  th:value="${task.id}"  onclick="completeTaskWithAssignee(value)">设置任务办理人并完成任务</button>
                <button th:value="${task.processInstanceId}" onclick="showImage(value)">显示流程图</button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

    <div id="imgDiv"></div>

</div>
</body>

<script>


    function completeTask(data) {
        $.ajax({
            url:"/task/completeTask",
            data:{"taskId":data},
            type:"GET",
            dataType:"text",
            async:true,
            success:function (data) {
                console.log(data);
                alert("完成任务");
                window.location.reload();

               /* window.location.href="/task/processDiagram/"*/
            },
            error:function (data) {
                console.log(data);
            }

        });
        console.log(data)
    }

    function showImage(data) {
        console.log(data);
        $("#imgDiv").empty().append("<img src='/task/processDiagram?processId="+data+"'>")
       /* $("#imgDiv").append("<img src='/task/processDiagram?processId="+data+"'>");*/
    };

    function completeTaskWithAssignee(taskId) {

        var assignee = $("#assignee").val();

        $.ajax({
            url:"/task/completeTask",
            data:{"taskId":taskId,"assignee":assignee},
            type:"GET",
            /*dataType:"text",*/
            async:true,
            success:function (data) {
                console.log(data);
                alert(data);
                window.location.reload();

            },
            error:function (data) {
                alert(data.get(responseText));
                console.log(data);
            }

        })


    }

    function logout() {
        $.ajax({
            url:"/idm/logout",
            success:function (data) {
                console.log(data);
                alert("成功退出");
                window.location.href="/";

            },
            error:function (data) {
                console.log(data);
            }
        })
    }
</script>
</html>
